<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Selfnutri - Sign In</title>
  <link rel="icon" type="image/png" href="images/selfnutri-favicon.png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
  <style>
     /* Original CSS from signin.html (merged for convenience) */
    :root {
      --primary: #2196f3;
      --primary-light: #e3f2fd;
      --primary-dark: #1976d2;
      --text: #333;
      --text-light: #666;
      --bg: #f5f7fa;
      --card-bg: #fff;
      --border: #e0e0e0;
      --radius: 16px;
      --shadow: 0 4px 12px rgba(0,0,0,0.08);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Roboto', 'Segoe UI', Arial, sans-serif;
  background: var(--bg);
  color: var(--text);
  line-height: 1.6;
  min-height: 100vh;
  margin: 0;
  padding: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}

    .footer {
      margin-top: 40px;
      color: #888;
      font-size: 0.95em;
      text-align: center;
      width: 100%;
    }
    /* Policies Modal Styles */
    .modal {
        display: none; /* Hidden by default */
        position: fixed; /* Stay in place */
        z-index: 1000; /* Sit on top (higher than other elements) */
        left: 0;
        top: 0;
        width: 100%; /* Full width */
        height: 100%; /* Full height */
        overflow: auto; /* Enable scroll if needed */
        background-color: rgba(0,0,0,0.6); /* Black w/ opacity */
        align-items: center; /* Center vertically */
        justify-content: center; /* Center horizontally */
        backdrop-filter: blur(5px); /* Optional: blurred background */
    }
      .special-header {
            width: 95%;
            background-color: #ffffff;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: relative;
            border-radius: 18px;
            margin: 20px auto;
            box-sizing: border-box;
            max-width: 1200px; /* Limit header width */ 
            transition: box-shadow 0.3s ease;
            z-index: 2000;
        }
        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            color: #2196f3;
            text-decoration: none;
            display: flex;
            align-items: center;
        }
        .logo i {
            margin-right: 8px;
            color: #2196f3;
        }
    .auth-container { 
        display: flex; 
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 20px;
        background-color: #fff; /* White background for auth container */
        border-radius: 10px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        width: 100%;
        max-width: 500px; /* Limit width for better readability */
        margin: 0 auto; /* Center the container */  
      }

    .modal-content {
        background-color: #fefefe;
        margin: auto; /* For browsers that don't fully support flex centering */
        padding: 30px;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        width: 90%;
        max-width: 800px; /* Adjust as needed */
        position: relative;
        max-height: 90vh; /* Limit height of modal content */
        overflow-y: auto; /* Enable scrolling for modal content */
        animation: fadeIn 0.3s ease-out; /* Optional fade-in animation */
        color: #333; /* Default text color */
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(-20px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .close-button {
        color: #aaa;
        position: absolute;
        top: 15px;
        right: 25px;
        font-size: 32px;
        font-weight: bold;
        cursor: pointer;
        transition: color 0.3s;
        z-index: 2000; /* Ensure close button is above modal content */
    }
    .close-button:hover,
    .close-button:focus {
        color: #333;
        text-decoration: none;
    }

    .modal-content h2 {
        color: #2196f3; /* Primary blue for main title */
        margin-top: 0;
        font-size: 2rem;
        margin-bottom: 20px;
        text-align: center;
    }

    .modal-content h3 {
        color: #444;
        font-size: 1.4rem;
        margin-top: 25px;
        margin-bottom: 10px;
        border-bottom: 1px solid #eee; /* Light separator */
        padding-bottom: 5px;
    }

    .policy-section {
        margin-bottom: 30px;
    }

    .policy-section p {
        margin-bottom: 10px;
        line-height: 1.6;
    }

    .policy-section ul, .policy-section ol {
        padding-left: 25px;
        margin-bottom: 15px;
    }

    .policy-section ul li, .policy-section ol li {
        margin-bottom: 8px;
        line-height: 1.5;
    }

   
  
    
  
    h1, h2, h3 {
      font-weight: 600;
      margin-bottom: 8px;
    }

    p {
      color: var(--text-light);
      margin-bottom: 16px;
    }

    /* Auth Containers */
    .auth-container, .welcome-container {
       display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 20px;
  background-color: #fff;
  border-radius: 10px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.1);
  max-width: 420px;   /* Reduce max-width for a tighter card */
  width: 100%;
  margin: 0 auto;     /* Center horizontally */
}

    .auth-header, .welcome-header {
      text-align: center;
      margin-bottom: 32px;
    }

    .auth-footer {
      text-align: center;
      margin-top: 24px;
      color: var(--text-light);
    }

    .auth-footer a {
      color: var(--primary);
      text-decoration: none;
    }

    /* Forms */
    .auth-form, .profile-form {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .input-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .input-group label {
      font-weight: 500;
      color: var(--text);
    }

    .input-group input,
    .input-group select {
      padding: 14px;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 1rem;
      transition: border 0.2s;
    }

    .input-group input:focus,
    .input-group select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 2px var(--primary-light);
    }

    .checkbox-group {
      flex-direction: row;
      align-items: center;
      gap: 8px;
    }

    .checkbox-group label {
      font-weight: normal;
    }

    .forgot-link {
      margin-left: auto;
      color: var(--primary);
      text-decoration: none;
      font-size: 0.9rem;
    }

    /* Buttons */
    .btn-primary {
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 8px;
      padding: 16px;
      font-size: 1.1rem;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.2s;
      text-align: center;
    }

    .btn-primary:hover {
      background: var(--primary-dark);
    }

    .btn-secondary {
      background: transparent;
      color: var(--primary);
      border: 1px solid var(--primary);
      border-radius: 8px;
      padding: 16px;
      font-size: 1.1rem;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.2s;
    }

    .btn-secondary:hover {
      background: var(--primary-light);
    }

    .btn-block {
      width: 100%;
      display: block;
    }

    /* Welcome Page */
    .welcome-card {
      background: var(--primary-light);
      border-radius: var(--radius);
      padding: 24px;
      margin-bottom: 32px;
    }

    .avatar-placeholder {
      width: 80px;
      height: 80px;
      background: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 16px;
      font-size: 2rem;
    }

    .welcome-actions {
      display: flex;
      gap: 12px;
      margin-top: 24px;
    }

    .welcome-features {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 16px;
      margin-bottom: 32px;
    }

    .feature-card {
      background: var(--card-bg);
      border-radius: var(--radius);
      padding: 16px;
      text-align: center;
    }

    .feature-icon {
      font-size: 2rem;
      margin-bottom: 12px;
    }
    .error-message {
        color: red;
        font-size: 0.9em;
        margin-top: -10px;
        margin-bottom: 10px;
    }

    .modal.is-open {
        display: flex; /* Show modal when open */
    }

  </style>
</head>
<body>
 <div class="special-header">
  <a href="index.html" class="logo">
  <span style="display:flex;align-items:center;">
  <img src="images/selfnutri.png" alt="Selfnutri Logo" style="height:38px;vertical-align:middle;margin-right:10px;">
  <span style="font-size:1.8rem;font-weight:bold;font-family: 'Roboto', 'Segoe UI', Arial, sans-serif;">
    <span style="color:#111;">Self</span><span style="color:#2196f3;">nutri</span>
    </span>
  </span>
  </a>
    </div>
  </div>
  <div id="loadingOverlay" style="position:fixed;z-index:3000;top:0;left:0;width:100vw;height:100vh;background:#fff;display:flex;align-items:center;justify-content:center;">
  <span style="font-size:1.2rem;color:#2196f3;">Loading...</span>
</div>

  <div class="auth-container">
    <div class="auth-header">
      <h1>Welcome Back</h1>
      <p>Sign in to continue your nutrition journey</p>
    </div>

    <form class="auth-form" id="signinForm">
      <div class="input-group">
        <label for="loginEmail">Email</label>
        <input type="email" id="loginEmail" required>
      </div>

      <div class="input-group">
        <label for="loginPassword">Password</label>
        <input type="password" id="loginPassword" required>
      </div>

      <div class="input-group checkbox-group">
        <input type="checkbox" id="remember">
        <label for="remember">Remember me</label>
        <a href="#" class="forgot-link">Forgot Password?</a>
      </div>

      <p class="terms-agreement">
          By signing in, you agree to our
          <a href="#" id="termsAndPoliciesLink">Terms and Policies</a>
      </p>

      <button type="submit" class="btn-primary">Sign In</button>
      <p id="signinErrorMessage" class="error-message"></p>
    </form>

    <div class="auth-footer">
      <p>Don't have an account? <a href="signup.html">Sign Up</a></p>
    </div>
  </div>

  <div id="policiesModal" class="modal">
      <div class="modal-content">
          <!-- 1) Give your button a unique ID… -->
          <span id="close-modal" class="close-button">&times;</span>

          
          <h2 id="modalPolicyTitle">Terms and Policies</h2>

          
          <div class="policy-section">
              <h3>Selfnutri - Terms of Use (MVP Showcase)</h3>
              <p>Welcome to Selfnutri! This is an early-stage, Minimum Viable Product (MVP) designed to showcase potential functionality related to BMI tracking, calorie management, water intake, and AI-powered recipe suggestions.</p>
              <p>By using this application, you agree to these basic terms:</p>
              <ol>
                  <li><strong>Purpose:</strong> Selfnutri is provided "as is" for demonstration and experimental purposes only. It is intended to illustrate concepts and features.</li>
                  <li><strong>No Guarantee:</strong> We do not guarantee the accuracy, reliability, or completeness of any information, calculations (e.g., BMI, calories), or AI-generated content (e.g., recipes) provided by the application.</li>
                  <li><strong>Your Responsibility:</strong> You are solely responsible for your use of the application and any decisions made based on its output.</li>
                  <li><strong>No Misuse:</strong> Do not attempt to reverse-engineer, hack, or otherwise misuse the application.</li>
                  <li><strong>Changes:</strong> We may change or discontinue any part of this MVP at any time without notice.</li>
              </ol>
              <p>Your use of this MVP constitutes your acceptance of these terms.</p>
          </div>

          <div class="policy-section">
              <h3>Selfnutri - Privacy Policy (MVP Showcase)</h3>
              <p>This Privacy Policy describes how Selfnutri (an MVP showcase project) handles information when you use our application.</p>
              <ol>
                  <li><strong>Information We Collect (for demonstration):</strong>
                      <ul>
                          <li><strong>Direct Input:</strong> For features like BMI calculation, calorie tracking, and water tracking, you may input personal metrics (e.g., height, weight, food intake, water intake). This data is typically processed locally within your browser or device for immediate functionality display and <em>is generally not stored persistently on our servers for this MVP</em>.</li>
                          <li><strong>Usage Data:</strong> We may collect anonymous, aggregated data about how the application is used (e.g., which features are accessed most often) to understand user interaction and improve the demonstration. This data does not identify you personally.</li>
                      </ul>
                  </li>
                  <li><strong>Data Sharing:</strong> For this MVP showcase, we generally do not share any personal data with third parties. Any aggregated usage data collected is anonymous.</li>
                  <li><strong>Data Security:</strong> While we take reasonable steps to protect data within the scope of an MVP, please be aware that no system is 100% secure. Do not enter highly sensitive personal information into this demonstration app.</li>
                  <li><strong>No Persistent Storage:</strong> For the purpose of this MVP, most of your input data (e.g., calorie logs, water intake) is reset when you close or refresh the browser, unless explicitly stated otherwise within a specific feature.</li>
                  </ul>
                  </li>
                  <li><strong>Data Sharing:</strong> For this MVP showcase, we generally do not share any personal data with third parties. Any aggregated usage data collected is anonymous.</li>
                  <li><strong>Data Security:</strong> While we take reasonable steps to protect data within the scope of an MVP, please be aware that no system is 100% secure. Do not enter highly sensitive personal information into this demonstration app.</li>
                  <li><strong>No Persistent Storage:</strong> For the purpose of this MVP, most of your input data (e.g., calorie logs, water intake) is reset when you close or refresh the browser, unless explicitly stated otherwise within a specific feature.</li>
              </ul>
              <p>By using Selfnutri, you consent to the handling of information as described in this policy for the purpose of this MVP demonstration.</p>
          </div>

          <div class="policy-section">
              <h3>Selfnutri - Health & Medical Disclaimer (MVP Showcase)</h3>
              <p><strong>IMPORTANT: This application is for informational and demonstration purposes only.</strong></p>
              <p>Selfnutri is an MVP (Minimum Viable Product) designed to illustrate potential features for health, fitness, and nutrition tracking.</p>
              <ul>
                  <li><strong>NOT MEDICAL ADVICE:</strong> The information provided by Selfnutri, including BMI calculations, calorie goals, water intake recommendations, and AI-generated recipe suggestions, is intended to be used only for informational purposes and is <strong>not medical advice, diagnosis, or treatment.</strong></li>
                  <li><strong>CONSULT A PROFESSIONAL:</strong> Always consult with a qualified healthcare professional, doctor, registered dietitian, or nutritionist before making any decisions about your diet, exercise, or health. Do not disregard professional medical advice or delay seeking it because of something you have read or seen in this application.</li>
                  <li><strong>ACCURACY:</strong> While we strive for accuracy in our demonstration, we do not warrant the completeness, reliability, or accuracy of any information presented. Results from using this application may vary and are not guaranteed.</li>
                  <li><strong>NO DOCTOR-PATIENT RELATIONSHIP:</strong> Your use of this application does not create a doctor-patient, therapist-patient, or any other professional healthcare relationship.</li>
              </ul>
              <p>By using Selfnutri, you acknowledge and agree to this disclaimer.</p>
          </div>
      </div>
  </div>
  
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-analytics-compat.js"></script>
  <script>
    // Your Firebase configuration (keep this as you have it)
    const firebaseConfig = {
      apiKey: "AIzaSyBhEHEgjRhj8NRkP1t4Ua53kcnFxaS5Zp8",
      authDomain: "selfnutriapp.firebaseapp.com",
      projectId: "selfnutriapp",
      storageBucket: "selfnutriapp.firebasestorage.app",
      messagingSenderId: "244812012239",
      appId: "1:244812012239:web:74ff5518334352787575ba",
      measurementId: "G-EMGEHKS4NH"
    };

    // Initialize Firebase (keep this as you have it)
    // Make sure 'db' is also initialized if used in onAuthStateChanged for Firestore checks
    const app = firebase.initializeApp(firebaseConfig); // Assign to 'app'
    const auth = firebase.auth();
    const db = firebase.firestore(); // IMPORTANT: Ensure Firestore is initialized for auth.onAuthStateChanged check

    const policiesModal = document.getElementById('policiesModal');
    const closeBtn = document.getElementById('close-modal'); // Correct ID from your HTML
    const termsLink = document.getElementById('termsAndPoliciesLink');
    const modalContent = policiesModal ? policiesModal.querySelector('.modal-content') : null;

// Function to show the modal
function showPoliciesModal() {
    if (policiesModal) {
        policiesModal.classList.add('is-open');
    }
}
function hidePoliciesModal() {
    if (policiesModal) {
        policiesModal.classList.remove('is-open');
    }
    if (modalContent) {
        modalContent.scrollTop = 0; // Reset scroll position when closing
    }
    console.log('Modal closed');
}

// --- Event Listeners for Terms and Policies Modal ---

// 1. Open modal when terms link is clicked
    if (termsLink) {
          termsLink.addEventListener('click', function(e) {
              e.preventDefault();
              showPoliciesModal();
          });
      }

// 2. Close modal when the 'x' close button is clicked
// FIXED: Using 'closeBtn' directly as defined
    if (closeBtn) { // <--- MODIFIED LINE: Changed 'close-button' to 'closeBtn'
        closeBtn.addEventListener('click', hidePoliciesModal);
    }

// 3. Close modal when clicking outside the modal content (on the overlay)
    if (policiesModal) {
        policiesModal.addEventListener('click', function(event) {
          if (event.target === policiesModal) {
            hidePoliciesModal();
        }
    });
  }

// 4. IMPORTANT: Stop propagation for clicks *within* the modal content
    if (modalContent) {
        modalContent.addEventListener('click', function(event) {
        event.stopPropagation();
      });
    }

    if (closeBtn) {
    closeBtn.addEventListener('click', function() {
        console.log('Close button clicked');
        hidePoliciesModal();
    });
}

    // --- Firebase Login Form Submission (keep as is) ---
    const signinErrorMessage = document.getElementById('signinErrorMessage'); // Make sure you have this element in HTML

    document.getElementById('signinForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        const email = document.getElementById('loginEmail').value;
        const password = document.getElementById('loginPassword').value;

        try {
            await auth.signInWithEmailAndPassword(email, password);
            // Redirection is handled by auth.onAuthStateChanged
        } catch (error) {
            let message = 'An unknown error occurred.';
            switch (error.code) {
                case 'auth/user-not-found':
                case 'auth/wrong-password':
                case 'auth/invalid-credential':
                    message = 'Invalid email or password.';
                    break;
                case 'auth/invalid-email':
                    message = 'Invalid email address.';
                    break;
                case 'auth/user-disabled':
                    message = 'Your account has been disabled.';
                    break;
                default:
                    message = `Error: ${error.message}`;
                    break;
            }
            if (signinErrorMessage) {
                signinErrorMessage.textContent = message;
            }
            console.error('Sign in error:', error.message);
        }
    });

    // --- Firebase Auth State Observer for Redirection (keep as is) ---
    // Make sure 'db' is correctly initialized before this runs
   auth.onAuthStateChanged(async (user) => {
    const loadingOverlay = document.getElementById('loadingOverlay');
    const authContainer = document.querySelector('.auth-container');
    const currentPage = window.location.pathname.replace(/^\/+/, '');

    if (user) {
        try {
            const docSnap = await db.collection("users").doc(user.uid).get();
            const profileComplete = docSnap.exists && docSnap.data().profileComplete === true;

            if (profileComplete) {
                if (currentPage !== 'bmi.html') {
                    window.location.href = 'bmi.html';
                    return;
                }
            } else if (currentPage !== 'profile.html') {
                // If profile is not complete, redirect to profile page
                window.location.href = 'profile.html';
                return; // Prevent further execution
            } else {
                if (currentPage !== 'profile.html') {
                    window.location.href = 'profile.html';
                    return; // Prevent further execution
                }
            }
            // If already on the correct page (dashboard.html or profile.html), hide loading and show content
            if (loadingOverlay) loadingOverlay.style.display = 'none';
            if (authContainer) authContainer.style.display = '';
        } catch (error) {
            console.error("Error checking user profile in Firestore:", error);
            if (currentPage !== 'profile.html') {
                window.location.href = 'profile.html';
                return;
            }
            // If already on profile.html, hide loading and show content
            if (loadingOverlay) loadingOverlay.style.display = 'none';
            if (authContainer) authContainer.style.display = '';
        }
    } else {
        // No user logged in, show sign-in form
        if (loadingOverlay) loadingOverlay.style.display = 'none';
        if (authContainer) authContainer.style.display = '';
    }
});

    // --- Loading Overlay Logic ---
    window.addEventListener('load', function() {
        const loadingOverlay = document.getElementById('loadingOverlay');
        if (loadingOverlay) {
            loadingOverlay.style.display = 'none'; // Hide loading overlay when page is fully loaded
        }
    });
  </script>
  <div class="footer">
    &copy; 2025 Selfnutri. All rights reserved.
  </div>
</body>
</html>